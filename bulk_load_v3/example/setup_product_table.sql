-- Setup PRODUCT table for Bulk Load Example
-- This table has 10 columns with various data types and nullability constraints.

-- Drop MV_PRODUCT if it exists
BEGIN
   EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW MV_PRODUCT';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -12003 THEN RAISE; END IF;
END;
/

-- Drop PRODUCT table if it exists
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE PRODUCT CASCADE CONSTRAINTS PURGE';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -942 THEN RAISE; END IF;
END;
/

CREATE TABLE PRODUCT (
    PRODUCT_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    PRODUCT_CODE   VARCHAR2(50) NOT NULL,
    PRODUCT_NAME   VARCHAR2(255) NOT NULL,
    DESCRIPTION    VARCHAR2(1000), -- Nullable
    CATEGORY       VARCHAR2(100) NOT NULL,
    STANDARD_COST  NUMBER(10, 2) NOT NULL,
    LIST_PRICE     NUMBER(10, 2) NOT NULL,
    REORDER_LEVEL  NUMBER(5),      -- Nullable
    TARGET_LEVEL   NUMBER(5),      -- Nullable
    DISCONTINUED   NUMBER(1) DEFAULT 0 NOT NULL,
    UPDATED_AT     TIMESTAMP
);

-- Optional: Add comments or indexes if needed
COMMENT ON TABLE PRODUCT IS 'Product catalog for bulk load demonstration';


-- Required by bulk_load_v3: Materialized View for refresh demonstration
CREATE MATERIALIZED VIEW MV_PRODUCT
BUILD IMMEDIATE
REFRESH COMPLETE ON DEMAND
AS
SELECT * FROM PRODUCT;
